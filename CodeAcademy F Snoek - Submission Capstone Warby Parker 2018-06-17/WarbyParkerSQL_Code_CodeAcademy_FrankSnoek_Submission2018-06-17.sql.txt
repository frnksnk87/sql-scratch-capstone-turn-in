/* SQL syntax Capstone codeacademy funnels Frank Snoek
   Really enjoyed the project! */

--#1
SELECT *
FROM survey
LIMIT 10;

--#2
SELECT question, COUNT(*)
FROM survey
GROUP BY question;

--#3
--= Round(B3/$B$8 * 100; 2)  [google spreadsheets]

--#4
SELECT *
FROM quiz 
LIMIT 5;

SELECT *
FROM home_try_on 
LIMIT 5;

SELECT *
FROM purchase
LIMIT 5;
 
--#5	
SELECT DISTINCT q.user_id,
	h.user_id IS NOT NULL AS 'is_home_try_on',
	h.number_of_pairs,
  p.user_id IS NOT NULL AS 'is_purchase'
 FROM quiz AS q
 LEFT JOIN home_try_on AS h
 		ON q.user_id = h.user_id
 LEFT JOIN purchase AS p
 		ON p.user_id = q.user_id
 LIMIT 10;

--#6
WITH results AS (
SELECT DISTINCT q.user_id,
	h.user_id IS NOT NULL AS 'is_home_try_on',
	h.number_of_pairs,
  p.user_id IS NOT NULL AS 'is_purchase'
 FROM quiz AS q
 LEFT JOIN home_try_on AS h
 		ON q.user_id = h.user_id
 LEFT JOIN purchase AS p
 		ON p.user_id = q.user_id)
SELECT COUNT(*) AS 'conversion_rates',
COUNT(
  CASE
  	WHEN is_home_try_on = 1 THEN user_id
  	ELSE NULL
	END) AS 'num_tried_on',
COUNT(
  CASE 
  WHEN is_purchase = 1 THEN user_id
  ELSE NULL
  END) AS 'num_purchase',
  1.0 * SUM(is_home_try_on) / COUNT(user_id) AS '%quiz_to_tryout',
  1.0 * SUM(is_purchase) / SUM(is_home_try_on) AS '%tryout_to_purchase',
  1.0 * SUM(number_of_pairs = '3 pairs') / SUM(is_purchase) AS '%3_pairs_tried_and_purchase',
  1.0 * SUM(number_of_pairs = '5 pairs') / SUM(is_purchase) AS '%5_pairs_tried_and_purchase'
  FROM results;

SELECT model_name, COUNT(*)
FROM purchase
GROUP BY model_name;

SELECT style, COUNT(*)
FROM quiz
GROUP BY style;

SELECT fit, COUNT(*)
FROM quiz
GROUP BY fit;

SELECT price, model_name
FROM purchase
GROUP BY model_name;

--#THE END